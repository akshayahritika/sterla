<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>STERLA - Smart School Companion</title>
<style>
  :root {
    --bg-dark: #0e0e2f;
    --bg-gradient: linear-gradient(135deg, #4b6cb7, #182848);
    --primary-light: #7289da;
    --primary-dark: #283593;
    --accent: #6c63ff;
    --white: #f4f4f9;
    --error-red: #e55a5a;
    --success-green: #3cd48b;
  }
  * {
    margin: 0; padding: 0; box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
  }
  html, body {
    height: 100%;
    background: var(--bg-dark);
    color: var(--white);
  }
  /* Centered login container */
  #loginPage {
    height: 100vh;
    background: var(--bg-gradient);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }
  .login-container {
    background: rgba(255 255 255 / 0.12);
    padding: 30px 36px;
    border-radius: 16px;
    box-shadow: 0 0 20px var(--accent);
    max-width: 360px;
    width: 100%;
    text-align: center;
  }
  .login-container h2 {
    font-weight: 700;
    font-size: 2rem;
    margin-bottom: 18px;
  }
  .login-container input {
    width: 100%;
    padding: 14px 16px;
    margin: 12px 0;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
    background: rgba(255 255 255 / 0.2);
    color: var(--white);
  }
  .login-container input::placeholder {
    color: rgba(255 255 255, 0.7);
  }
  .login-container button {
    width: 100%;
    padding: 14px 0;
    border-radius: 12px;
    border: none;
    background: var(--accent);
    color: var(--white);
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.3s ease;
  }
  .login-container button:hover {
    background: #5140d5;
  }
  #loginMessage {
    margin-top: 10px;
    font-size: 0.9rem;
    min-height: 18px;
  }
  .or-text {
    margin: 22px 0 14px;
    font-weight: 700;
    font-size: 1rem;
    letter-spacing: 1.2px;
    color: rgba(255 255 255 / 0.75);
  }
  .social-login {
    display: flex;
    justify-content: space-between;
  }
  .social-btn {
    flex: 1;
    margin: 0 6px;
    padding: 12px 8px;
    border: 2px solid var(--white);
    border-radius: 12px;
    color: var(--white);
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    background: transparent;
    transition: all 0.3s ease;
  }
  .social-btn:hover {
    background: var(--accent);
    border-color: var(--accent);
    color: var(--white);
  }

  /* Main app container */
  #appPage {
    display: none;
    height: 100vh;
    width: 100%;
    display: flex;
    background: var(--bg-gradient);
  }
  /* Sidebar */
  #sidebar {
    width: 260px;
    background: var(--primary-dark);
    padding: 28px 20px;
    color: var(--white);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  #sidebar h2 {
    font-size: 2.4rem;
    margin-bottom: 30px;
  }
  .nav-btn {
    background: transparent;
    color: var(--white);
    border: none;
    padding: 16px 20px;
    border-radius: 16px;
    font-size: 1.2rem;
    text-align: left;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .nav-btn:hover {
    background: var(--primary-light);
  }
  #main {
    flex-grow: 1;
    padding: 36px 48px;
    overflow-y: auto;
    color: var(--white);
  }
  .page {
    display: none;
  }
  .page.active {
    display: block;
  }

  /* Welcome */
  #welcomeBox {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(108, 99, 255, 0.15);
    border-radius: 24px;
    padding: 48px;
    margin-bottom: 32px;
  }
  #welcomeBox h2 {
    font-size: 3rem;
    max-width: 64%;
  }
  #welcomeBox p {
    font-size: 1.3rem;
    margin-top: 14px;
    max-width: 64%;
  }
  #welcomeBox img {
    width: 180px;
    filter: drop-shadow(0 0 12px rgba(108, 99, 255, 0.7));
  }

  /* Subject Cards */
  .subject-card {
    padding: 22px;
    margin: 18px 16px;
    background: var(--bg-dark);
    border-radius: 24px;
    border: 2px solid var(--primary-light);
    width: 178px;
    text-align: center;
    cursor: pointer;
    user-select: none;
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--white);
    transition: background 0.4s ease, color 0.4s ease;
  }
  .subject-card:hover {
    background: var(--primary-light);
    color: var(--bg-dark);
  }

  /* Topic Buttons */
  .topic-btn {
    padding: 16px 26px;
    margin: 10px 8px;
    border-radius: 26px;
    background: var(--primary-light);
    color: var(--white);
    font-size: 1.2rem;
    cursor: pointer;
    border: none;
    user-select: none;
    transition: background 0.3s ease;
  }
  .topic-btn:hover {
    background: var(--accent);
  }

  /* Output Boxes */
  .output-box {
    background: rgba(255 255 255 / 0.1);
    border-radius: 24px;
    padding: 36px;
    min-height: 260px;
    font-size: 1.2rem;
    line-height: 1.6;
  }
  .announce {
    background: rgba(108, 99, 255, 0.15);
    padding: 14px 24px;
    border-radius: 20px;
    margin-bottom: 18px;
    font-size: 1.1rem;
  }

  /* Chat */
  #chatBox {
    background: rgba(255 255 255 / 0.1);
    padding: 24px;
    border-radius: 20px;
    height: 460px;
    overflow-y: auto;
    margin-bottom: 18px;
    font-size: 1rem;
    line-height: 1.5;
  }
  #chatBox div {
    margin-bottom: 14px;
  }
  #chatInput {
    padding: 18px;
    border-radius: 16px;
    border: none;
    width: 77%;
    font-size: 1.1rem;
    background: rgba(255 255 255 / 0.1);
    color: var(--white);
    margin-right: 12px;
  }
  #chatInput::placeholder {
    color: rgba(255 255 255 / 0.6);
  }
  #chatBtn {
    background: var(--accent);
    border: none;
    color: white;
    font-size: 1.1rem;
    padding: 18px 36px;
    border-radius: 16px;
    cursor: pointer;
    font-weight: 700;
    transition: background 0.3s ease;
  }
  #chatBtn:hover {
    background: #6258d4;
  }

  /* Mindmap */
  #flowArea {
    background: rgba(255 255 255 / 0.15);
    border-radius: 22px;
    border: 3px solid var(--primary-light);
    margin-top: 28px;
    position: relative;
    overflow: auto;
    width: 100%;
    height: 620px;
  }
  svg {
    user-select: none;
  }

  /* Toast */
  .toast {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 48px;
    padding: 14px 32px;
    border-radius: 24px;
    color: white;
    font-weight: 700;
    font-size: 1.2rem;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    z-index: 9999;
    animation: fadein 0.3s, fadeout 0.3s 1.2s;
  }
  .toast-success {background: var(--success-green);}
  .toast-error {background: var(--error-red);}
  @keyframes fadein {from {opacity: 0;} to {opacity: 1;}}
  @keyframes fadeout {from {opacity: 1;} to {opacity: 0;}}
</style>
</head>
<body>

<div id="loginPage" aria-label="Optional login screen">
  <div class="login-container" role="form" aria-labelledby="loginTitle">
    <h2 id="loginTitle">Optional Login</h2>
    <p>Use email/passcode or sign up via Google, Facebook or Phone. Or continue without login.</p>
    <input type="email" id="email" placeholder="Enter Email" aria-label="Email (optional)" />
    <input type="password" id="passcode" placeholder="Enter Passcode" aria-label="Passcode (optional)" />
    <button onclick="login()">Login</button>
    <p id="loginMessage" role="alert"></p>
    <div class="or-text" aria-hidden="true">OR Sign up with</div>
    <div class="social-login" role="region" aria-label="Social login options">
      <button class="social-btn" onclick="alert('Google login not implemented')" aria-label="Sign up with Google">Google</button>
      <button class="social-btn" onclick="alert('Facebook login not implemented')" aria-label="Sign up with Facebook">Facebook</button>
      <button class="social-btn" onclick="alert('Phone login not implemented')" aria-label="Sign up with Phone Number">Phone Number</button>
    </div>
    <div style="margin-top:20px; font-size:1rem; color: #ccc;">
      Or <button style="background:none; border:none; color: var(--accent); cursor:pointer; font-weight: bold;" onclick="skipLogin()">Continue without login</button>
    </div>
  </div>
</div>

<div id="appPage" role="main" aria-live="polite" aria-atomic="true" aria-relevant="additions">
  <nav id="sidebar" aria-label="Main navigation">
    <h2>STERLA</h2>
    <button class="nav-btn" onclick="showPage('homePage')" aria-label="Go to Home">Home</button>
    <button class="nav-btn" onclick="showPage('dashboard')" aria-label="Go to Dashboard">Dashboard</button>
    <button class="nav-btn" onclick="showPage('subjectsPage')" aria-label="Go to Subjects">Subjects</button>
    <button class="nav-btn" onclick="showPage('mindmap')" aria-label="Go to Mind Map">Mind Map</button>
    <button class="nav-btn" onclick="showPage('quizPage')" aria-label="Go to Quiz">Quiz</button>
    <button class="nav-btn" onclick="showPage('wsPage')" aria-label="Go to Worksheet">Worksheet</button>
    <button class="nav-btn teacher-only" onclick="showPage('managePage')" aria-label="Go to Teacher Panel">Teacher Panel</button>
    <button class="nav-btn" onclick="showPage('aiChatPage')" aria-label="Go to AI Chat Assistant">AI Chat</button>
  </nav>

  <div id="main">
    <section id="homePage" class="page active" tabindex="-1">
      <h1 id="welcomeUser">Welcome to STERLA</h1>
      <div id="welcomeBox" class="glass" role="region" aria-label="Welcome message and quick instructions">
        <div>
          <h2>Your learning companion</h2>
          <p>Choose a subject → pick a topic → get mindmap / quiz / worksheet!</p>
        </div>
        <img src="https://cdn-icons-png.flaticon.com/512/2942/2942943.png" alt="School Icon" />
      </div>
      <div style="margin-top: 18px;">
        <h3>Quick Subjects</h3>
        <div id="subjectsQuick"></div>
      </div>
    </section>

    <section id="dashboard" class="page" tabindex="-1">
      <h1>Dashboard</h1>
      <h2>Announcements</h2>
      <div class="announce">• Chemistry worksheet due Monday</div>
      <div class="announce">• Biology test next Friday</div>
      <div class="announce">• Math homework submission closes tonight</div>
    </section>

    <section id="subjectsPage" class="page" tabindex="-1">
      <h1>Select a Subject</h1>
      <div id="subjectsContainer"></div>
    </section>

    <section id="topicPage" class="page" tabindex="-1">
      <h1 id="topicTitle"></h1>
      <div id="topicButtons"></div>
    </section>

    <section id="mindmap" class="page" tabindex="-1">
      <h2>Flowchart Generator</h2>
      <label for="mmTopic">Select Topic:</label>
      <select id="mmTopic" aria-label="Select Topic for Mindmap"><option value="">Choose topic</option></select>
      <button onclick="loadFlowchart()" aria-label="Generate Flowchart">Generate Flowchart</button>
      <div id="flowArea">
        <svg id="flowSVG" width="2000" height="2000"></svg>
      </div>
    </section>

    <section id="quizPage" class="page" tabindex="-1">
      <h1>Quiz</h1>
      <div class="output-box" id="quizOutput"></div>
    </section>

    <section id="wsPage" class="page" tabindex="-1">
      <h1>Worksheet</h1>
      <div class="output-box" id="wsOutput"></div>
    </section>

    <section id="managePage" class="page teacher-only" tabindex="-1">
      <h1>Teacher Panel</h1>
      <p>Here you can upload worksheets, add quizzes, view submissions, manage announcements.</p>
    </section>

    <section id="aiChatPage" class="page" tabindex="-1">
      <h1>AI Chat Assistant</h1>
      <div id="chatBox" aria-live="polite" aria-atomic="true"></div>
      <input type="text" id="chatInput" placeholder="Ask me anything..." aria-label="Chat input" />
      <button id="chatBtn" aria-label="Send chat message">Send</button>
    </section>
  </div>
</div>

<script>
  // Startup popup
  window.onload = function() {
    if(confirm("Do you want to see our paid promotion?")){
      alert("Thank you for your interest! Visit our sponsor for awesome deals.");
    }
    loadSubjects();
  };

  // Elements
  const loginPage = document.getElementById("loginPage");
  const appPage = document.getElementById("appPage");
  const emailInput = document.getElementById("email");
  const passcodeInput = document.getElementById("passcode");
  const loginMsg = document.getElementById("loginMessage");
  const subjectsQuick = document.getElementById("subjectsQuick");
  const topicTitle = document.getElementById("topicTitle");
  const topicButtons = document.getElementById("topicButtons");
  const chatBtn = document.getElementById("chatBtn");
  const chatInput = document.getElementById("chatInput");
  const chatBox = document.getElementById("chatBox");
  const mmTopicSelect = document.getElementById("mmTopic");
  const svgContainer = document.getElementById("flowSVG");
  const diagramTitle = document.querySelector("#mindmap h2");
  const welcomeUser = document.getElementById("welcomeUser");

  // Simple subject/topic data (expand as needed)
  const subjectTopics = {
    English: ["Grammar", "Formal Letter", "Speech", "Prose"],
    Math: ["Algebra", "Linear Equations", "Mensuration"],
    Science: ["Reproduction in Animals", "Sound", "Electricity"],
    "Social Science":
